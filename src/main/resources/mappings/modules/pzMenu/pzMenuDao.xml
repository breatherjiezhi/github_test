<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dhc.rad.modules.pzMenu.dao.PzMenuDao">
    <resultMap id="BaseResultMap" type="com.dhc.rad.modules.pzMenu.entity.PzMenu" >
        <result column="menu_name" property="menuName" />
        <result column="restaurant_id" property="restaurantId" />
        <result column="menu_description" property="menuDescription" />
        <result column="menu_img_url" property="menuImgUrl" />
        <result column="menu_limited" property="menuLimited" />
        <result column="menu_count" property="menuCount" />
        <result column="menu_type" property="menuType" />
        <result column="menu_status" property="menuStatus" />
        <result column="menu_up" property="menuUp" />
        <result column="examine_info" property="examineInfo" />
        <result column="create_by" property="createBy.id" />
        <result column="update_by" property="updateBy.id" />
        <result column="create_date" property="createDate" />
        <result column="update_date" property="updateDate" />
        <result column="remarks" property="remarks" />
        <result column="del_flag" property="delFlag" />
        <result column="gcs_name" property="gcsName" />
    </resultMap>

    <update id="deleteByIds">
        UPDATE pz_menu
        SET
        del_flag = '1'
        WHERE id in
        <foreach collection="list" item="id" index="index"
                 open="(" close=")" separator=",">
            #{id}
        </foreach>
    </update>


    <select id="findMenuList" resultMap="BaseResultMap">
        SELECT
        ID,
        restaurant_id,
        menu_name,
        menu_description,
        menu_img_url,
        menu_limited,
        menu_count,
        menu_type,
        menu_status,
        menu_up,
        examine_info,
        create_by,
        update_by,
        create_date,
        update_date,
        remarks,
        del_flag
        FROM
        pz_menu
        WHERE del_flag ='0' and CREATE_BY = #{userId}
        <if test ="null != pzMenu.restaurantId and ''!= pzMenu.restaurantId"> AND restaurant_id = #{pzMenu.restaurantId}</if>
        <if test ="null != pzMenu.menuName and ''!= pzMenu.menuName"> AND menu_name like concat('%',#{pzMenu.menuName},'%')</if>
        <if test ="null != pzMenu.menuDescription and ''!= pzMenu.menuDescription"> AND menu_description like concat('%',#{pzMenu.menuDescription},'%')</if>
        <if test ="null != pzMenu.menuImgUrl and ''!= pzMenu.menuImgUrl"> AND menu_img_url like concat('%',#{pzMenu.menuImgUrl},'%')</if>
        <if test ="null != pzMenu.menuLimited and ''!= pzMenu.menuLimited"> AND menu_limited = #{pzMenu.menuLimited}</if>
        <if test ="null != pzMenu.menuCount and ''!= pzMenu.menuCount"> AND menu_count = #{pzMenu.menuCount}</if>
        <if test ="null != pzMenu.menuType and ''!= pzMenu.menuType"> AND menu_type = #{pzMenu.menuType}</if>
        <if test ="null != pzMenu.menuStatus and ''!= pzMenu.menuStatus"> AND menu_status = #{pzMenu.menuStatus}</if>
        <if test ="null != pzMenu.menuUp and ''!= pzMenu.menuUp"> AND menu_up = #{pzMenu.menuUp}</if>
        <if test ="null != pzMenu.examineInfo and ''!= pzMenu.examineInfo"> AND examine_info like concat('%',#{pzMenu.examineInfo},'%')</if>
        <if test ="null != pzMenu.createBy and ''!= pzMenu.createBy"> AND CREATE_BY = #{pzMenu.createBy.id}</if>
        <if test ="null != pzMenu.updateBy and ''!= pzMenu.updateBy"> AND UPDATE_BY = #{pzMenu.updateBy.id}</if>
        <if test ="null != pzMenu.createDate and ''!= pzMenu.createDate"> AND CREATE_DATE = #{pzMenu.createDate}</if>
        <if test ="null != pzMenu.updateDate and ''!= pzMenu.updateDate"> AND UPDATE_DATE = #{pzMenu.updateDate}</if>
        <if test ="null != pzMenu.remarks and ''!= pzMenu.remarks"> AND remarks = #{pzMenu.remarks}</if>
        <choose>
            <when test="pzMenu.page !=null and pzMenu.page.orderBy != null and pzMenu.page.orderBy != ''">
                ORDER BY ${pzMenu.page.orderBy}
            </when>
            <otherwise>
                ORDER BY  create_date DESC
            </otherwise>
        </choose>

    </select>

    <select id="get" resultMap="BaseResultMap">
        SELECT
            a.ID,
            restaurant_id,
            a.menu_name,
            a.menu_description,
            a.menu_img_url,
            a.menu_limited,
            a.menu_count,
            a.menu_type,
            a.menu_status,
            a.menu_up,
            a.examine_info,
            a.create_by,
            a.update_by,
            a.create_date,
            a.update_date,
            a.remarks,
            a.del_flag
        FROM pz_menu a
        WHERE a.ID = #{id} and a.del_flag ='0'
    </select>

    <insert id="insert" parameterType="com.dhc.rad.modules.pzMenu.entity.PzMenu">
        INSERT INTO pz_menu
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test ="null != id and ''!= id">
                id,
            </if>
            <if test ="null != restaurantId and ''!= restaurantId">
                restaurant_id,
            </if>
            <if test ="null != menuName and ''!= menuName">
                menu_name,
            </if>
            <if test ="null != menuDescription and ''!= menuDescription">
                menu_description,
            </if>
            <if test ="null != menuImgUrl and ''!= menuImgUrl">
                menu_img_url,
            </if>
            <if test ="null != menuLimited and ''!= menuLimited">
                menu_limited,
            </if>
            <if test ="null != menuCount and ''!= menuCount">
                menu_count,
            </if>
            <if test ="null != menuType and ''!= menuType">
                menu_type,
            </if>
            <if test ="null != menuStatus and ''!= menuStatus">
                menu_status,
            </if>
            <if test ="null != menuUp and ''!= menuUp">
                menu_up,
            </if>
            <if test ="null != examineInfo and ''!= examineInfo">
                examine_info,
            </if>
            <if test ="null != createBy and ''!= createBy">
                create_by,
            </if>
            <if test ="null != updateBy and ''!= updateBy">
                update_by,
            </if>
            <if test ="null != createDate and ''!= createDate">
                create_date,
            </if>
            <if test ="null != updateDate and ''!= updateDate">
                update_date,
            </if>
            <if test ="null != remarks and ''!= remarks">
                remarks,
            </if>
            <if test ="null != delFlag and ''!= delFlag">
                del_flag
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test ="null != id and ''!= id">
                #{id},
            </if>
            <if test ="null != restaurantId and ''!= restaurantId">
                #{restaurantId},
            </if>
            <if test ="null != menuName and ''!= menuName">
                #{menuName},
            </if>
            <if test ="null != menuDescription and ''!= menuDescription">
                #{menuDescription},
            </if>
            <if test ="null != menuImgUrl and ''!= menuImgUrl">
                #{menuImgUrl},
            </if>
            <if test ="null != menuLimited and ''!= menuLimited">
                #{menuLimited},
            </if>
            <if test ="null != menuCount and ''!= menuCount">
                #{menuCount},
            </if>
            <if test ="null != menuType and ''!= menuType">
                #{menuType},
            </if>
            <if test ="null != menuStatus and ''!= menuStatus">
                #{menuStatus},
            </if>
            <if test ="null != menuUp and ''!= menuUp">
                #{menuUp},
            </if>
            <if test ="null != examineInfo and ''!= examineInfo">
                #{examineInfo},
            </if>
            <if test ="null != createBy and ''!= createBy">
                #{createBy.id},
            </if>
            <if test ="null != updateBy and ''!= updateBy">
                #{updateBy.id},
            </if>
            <if test ="null != createDate and ''!= createDate">
                #{createDate},
            </if>
            <if test ="null != updateDate and ''!= updateDate">
                #{updateDate},
            </if>
            <if test ="null != remarks and ''!= remarks">
                #{remarks},
            </if>
            <if test ="null != delFlag and ''!= delFlag">
                #{delFlag}
            </if>
        </trim>
    </insert>

    <update id="update" parameterType="com.dhc.rad.modules.pzMenu.entity.PzMenu">
        UPDATE pz_menu
        <set>
            <if test ="null != restaurantId and ''!= restaurantId"> restaurant_id= #{restaurantId},</if>
            <if test ="null != menuName and ''!= menuName"> menu_name= #{menuName},</if>
            <if test ="null != menuDescription and ''!= menuDescription">  menu_description= #{menuDescription},</if>
            <if test ="null != menuImgUrl and ''!= menuImgUrl">  menu_img_url= #{menuImgUrl},</if>
            <if test ="null != menuLimited ">  menu_limited = #{menuLimited},</if>
            <if test ="null != menuCount ">  menu_count = #{menuCount},</if>
            <if test ="null != menuType  ">  menu_type = #{menuType},</if>
            <if test ="null != menuStatus  ">  menu_status = #{menuStatus},</if>
            <if test ="null != menuUp ">  menu_up = #{menuUp},</if>
            <if test ="null != examineInfo">  examine_info = #{examineInfo},</if>
            <if test ="null != createBy and ''!= createBy">  CREATE_BY = #{createBy.id},</if>
            <if test ="null != updateBy and ''!= updateBy">  UPDATE_BY = #{updateBy.id},</if>
            <if test ="null != createDate and ''!= createDate">  CREATE_DATE = #{createDate},</if>
            <if test ="null != updateDate and ''!= updateDate">  UPDATE_DATE = #{updateDate},</if>
            <if test ="null != remarks and ''!= remarks">  remarks = #{remarks}</if>
        </set>
        WHERE  id = #{id} and del_flag ='0'
    </update>
    <update id="upPzMenu">
        UPDATE pz_menu
        SET
        menu_up = '1'
        WHERE id in
        <foreach collection="list" item="id" index="index"
                 open="(" close=")" separator=",">
            #{id}
        </foreach>
    </update>
    <update id="downPzMenu">
        UPDATE pz_menu
        SET
        menu_up = '0'
        WHERE id in
        <foreach collection="list" item="id" index="index"
                 open="(" close=")" separator=",">
            #{id}
        </foreach>
    </update>
    <!--<update id="updateMenuStatus" parameterType="com.dhc.rad.modules.pzMenu.entity.PzMenu">
        UPDATE pz_menu
        set MENU_STATUS =#{menuStatus}
        WHERE  id = #{id} and del_flag ='0'
    </update>
    <update id="submitPzMenu">
        UPDATE pz_menu
        set MENU_STATUS ='1'
        WHERE  id = #{id} and del_flag ='0'
    </update>-->

    <select id="findList" resultMap="BaseResultMap">
        SELECT
        m.ID,
        m.menu_name,
        m.restaurant_id,
        m.menu_description,
        m.menu_img_url,
        m.menu_limited,
        m.menu_count,
        m.menu_type,
        m.menu_status,
        m.menu_up,
        m.examine_info,
        m.create_by,
        m.update_by,
        m.create_date,
        m.update_date,
        m.remarks,
        m.del_flag,
        o.name as gcs_name
        FROM
        pz_menu m
        LEFT JOIN sys_office o on  m.RESTAURANT_ID=o.ID
        WHERE m.del_flag ='0'
        <if test ="null != restaurantId and ''!= restaurantId"> AND m.restaurant_id = #{restaurantId}</if>
        <if test ="null != menuName and ''!= menuName"> AND m.menu_name like concat('%',#{menuName},'%')</if>
        <if test ="null != menuDescription and ''!= menuDescription"> AND m.menu_description like concat('%',#{menuDescription},'%')</if>
        <if test ="null != menuImgUrl and ''!= menuImgUrl"> AND m.menu_img_url like concat('%',#{menuImgUrl},'%')</if>
        <if test ="null != menuLimited and ''!= menuLimited"> AND m.menu_limited = #{menuLimited}</if>
        <if test ="null != menuCount and ''!= menuCount"> AND m.menu_count = #{menuCount}</if>
        <if test ="null != menuType and ''!= menuType"> AND m.menu_type = #{menuType}</if>
        <if test ="null != menuStatus and ''!= menuStatus"> AND m.menu_status = #{menuStatus}</if>
        <if test ="null != menuUp and ''!= menuUp"> AND m.menu_up = #{menuUp}</if>
        <if test ="null != examineInfo and ''!= examineInfo"> AND m.examine_info like concat('%',#{examineInfo},'%')</if>
        <if test ="null != createBy and ''!= createBy"> AND m.CREATE_BY = #{createBy.id}</if>
        <if test ="null != updateBy and ''!= updateBy"> AND m.UPDATE_BY = #{updateBy.id}</if>
        <if test ="null != createDate and ''!= createDate"> AND m.CREATE_DATE = #{createDate}</if>
        <if test ="null != updateDate and ''!= updateDate"> AND m.UPDATE_DATE = #{updateDate}</if>
        <if test ="null != remarks and ''!= remarks"> AND m.remarks = #{remarks}</if>
        <choose>
            <when test="page !=null and page.orderBy != null and page.orderBy != ''">
                ORDER BY m.${page.orderBy}
            </when>
            <otherwise>
                ORDER BY  m.create_date DESC
            </otherwise>
        </choose>

    </select>

    <update id="updateMenuCount" parameterType="com.dhc.rad.modules.pzMenu.entity.PzMenu">
        UPDATE pz_menu
        SET MENU_COUNT = #{menuCount}
        WHERE
            id = #{id}
          AND DEL_FLAG = '0'
    </update>

    <select id="findMenuCount" resultType="java.lang.Integer">
        SELECT
            MENU_COUNT
        FROM
            pz_menu
        WHERE
            ID = #{id}  AND del_flag = '0'
    </select>

</mapper>