<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dhc.rad.modules.pzOrderContent.dao.PzOrderContentDao">
    <resultMap id="BaseResultMap" type="com.dhc.rad.modules.pzOrderContent.entity.PzOrderContent">
        <result column="order_id" property="orderId"/>
        <result column="content_id" property="contentId"/>
        <result column="eat_flag" property="eatFlag"/>
        <result column="create_by" property="createBy.id"/>
        <result column="update_by" property="updateBy.id"/>
        <result column="create_date" property="createDate"/>
        <result column="update_date" property="updateDate"/>
        <result column="remarks" property="remarks"/>
        <result column="del_flag" property="delFlag"/>
    </resultMap>

    <update id="deleteByIds">
        UPDATE pz_order_content
        SET
        del_flag = '1'
        WHERE id in
        <foreach collection="list" item="id" index="index"
                 open="(" close=")" separator=",">
            #{id}
        </foreach>
    </update>


    <select id="get" resultMap="BaseResultMap">
        SELECT a.ID,
               a.order_id,
               a.content_id,
               a.eat_flag,
               a.create_by,
               a.update_by,
               a.create_date,
               a.update_date,
               a.remarks,
               a.del_flag
        FROM pz_order_content a
        WHERE a.ID = #{id}
          and a.del_flag = '0'
    </select>

    <insert id="insert" parameterType="com.dhc.rad.modules.pzOrderContent.entity.PzOrderContent">
        INSERT INTO pz_order_content
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="null != id and ''!= id">
                id,
            </if>
            <if test="null != orderId and ''!= orderId">
                order_id,
            </if>
            <if test="null != contentId and ''!= contentId">
                content_id,
            </if>
            <if test="null != eatFlag and ''!= eatFlag">
                eat_flag,
            </if>
            <if test="null != createBy and ''!= createBy">
                create_by,
            </if>
            <if test="null != updateBy and ''!= updateBy">
                update_by,
            </if>
            <if test="null != createDate and ''!= createDate">
                create_date,
            </if>
            <if test="null != updateDate and ''!= updateDate">
                update_date,
            </if>
            <if test="null != remarks and ''!= remarks">
                remarks,
            </if>
            <if test="null != delFlag and ''!= delFlag">
                del_flag
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="null != id and ''!= id">
                #{id},
            </if>
            <if test="null != orderId and ''!= orderId">
                #{orderId},
            </if>
            <if test="null != contentId and ''!= contentId">
                #{contentId},
            </if>
            <if test="null != eatFlag and ''!= eatFlag">
                #{eatFlag},
            </if>
            <if test="null != createBy and ''!= createBy">
                #{createBy.id},
            </if>
            <if test="null != updateBy and ''!= updateBy">
                #{updateBy.id},
            </if>
            <if test="null != createDate and ''!= createDate">
                #{createDate},
            </if>
            <if test="null != updateDate and ''!= updateDate">
                #{updateDate},
            </if>
            <if test="null != remarks and ''!= remarks">
                #{remarks},
            </if>
            <if test="null != delFlag and ''!= delFlag">
                #{delFlag}
            </if>
        </trim>
    </insert>

    <update id="update" parameterType="com.dhc.rad.modules.pzOrderContent.entity.PzOrderContent">
        UPDATE pz_order_content
        <set>
            <if test="null != orderId and ''!= orderId">order_id= #{orderId},</if>
            <if test="null != contentId and ''!= contentId">content_id= #{contentId},</if>
            <if test="null != createBy and ''!= createBy">CREATE_BY = #{createBy.id},</if>
            <if test="null != updateBy and ''!= updateBy">UPDATE_BY = #{updateBy.id},</if>
            <if test="null != createDate and ''!= createDate">CREATE_DATE = #{createDate},</if>
            <if test="null != updateDate and ''!= updateDate">UPDATE_DATE = #{updateDate},</if>
            <if test="null != eatFlag">eat_flag= #{eatFlag},</if>
            <if test="null != remarks and ''!= remarks">remarks = #{remarks}</if>
        </set>
        WHERE id = #{id} and del_flag ='0'
    </update>

    <select id="findList" resultMap="BaseResultMap">
        SELECT
        ID,
        order_id,
        content_id,
        eat_flag,
        create_by,
        update_by,
        create_date,
        update_date,
        remarks,
        del_flag
        FROM
        pz_order_content
        WHERE del_flag ='0'
        <if test="null != orderId and ''!= orderId">AND order_id = #{orderId}</if>
        <if test="null != contentId and ''!= contentId">AND content_id = #{contentId}</if>
        <if test="null != eatFlag and ''!= eatFlag">AND eat_flag = #{eatFlag}</if>
        <if test="null != createBy and ''!= createBy">AND CREATE_BY = #{createBy.id}</if>
        <if test="null != updateBy and ''!= updateBy">AND UPDATE_BY = #{updateBy.id}</if>
        <if test="null != createDate and ''!= createDate">AND CREATE_DATE = #{createDate}</if>
        <if test="null != updateDate and ''!= updateDate">AND UPDATE_DATE = #{updateDate}</if>
        <if test="null != remarks and ''!= remarks">AND remarks = #{remarks}</if>
        <choose>
            <when test="page !=null and page.orderBy != null and page.orderBy != ''">
                ORDER BY ${page.orderBy}
            </when>
            <otherwise>
                ORDER BY create_date DESC
            </otherwise>
        </choose>

    </select>
    <select id="getByContentIdAndCreateBy" resultMap="BaseResultMap">
         SELECT a.ID,
               a.order_id,
               a.content_id,
               a.eat_flag,
               a.create_by,
               a.update_by,
               a.create_date,
               a.update_date,
               a.remarks,
               a.del_flag
        FROM pz_order_content a
        WHERE a.content_id = #{contentId} and a.create_by = #{userId}
          and a.del_flag = '0'
    </select>
    <select id="findListByOrderId" resultType="java.util.Map">
    SELECT
	poc.CONTENT_ID as contentId,
	poc.EAT_FLAG as eatFlag,
	pm.MENU_IMG_URL AS imgUrl,
	pm.MENU_NAME AS menuName,
	pmc.MENU_DETAIL as menuDetail,
	pmc.EAT_DATE as eatDate,
	pmc.EAT_WEEK as eatWeek
FROM
	pz_order_content poc
	LEFT JOIN pz_menu_content pmc ON pmc.ID = poc.CONTENT_ID
	LEFT JOIN pz_menu pm ON pm.ID = pmc.MENU_ID
WHERE
	poc.ORDER_ID = #{orderId} ORDER BY pmc.EAT_DATE
    </select>
    <delete id="deleteContentByOrderId">
        update pz_order_content
        set
        del_flag ='1'
        where order_id = #{orderId} and create_by = #{userId}
    </delete>

    <select id="findCountByOrderId" resultType="java.lang.Integer">
        SELECT
        count(1)
        FROM
        pz_order_content
        WHERE del_flag = '0'
        <if test="null != orderId and ''!= orderId">AND order_id = #{orderId}</if>
        <if test="null != userId and ''!= userId">AND CREATE_BY = #{userId}</if>
        <if test="null != eatFlag and ''!= eatFlag">AND eat_flag = #{eatFlag}</if>
    </select>



</mapper>